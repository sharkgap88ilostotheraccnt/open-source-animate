<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Symbol Editor</title>
<style>
  body {
    background: #2b2b2b;
    color: #f0f0f0;
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* Top bar */
  #topBar {
    background: #1e1e1e;
    padding: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #444;
  }
  #topBar button {
    background: #3a3a3a;
    color: #fff;
    border: none;
    padding: 6px 12px;
    margin-right: 6px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
  }
  #topBar button:hover {
    background: #5a5a5a;
  }

  /* Main content */
  #mainContent {
    flex: 1;
    display: flex;
  }

  /* Toolbar */
  #toolbar {
    background: #252525;
    width: 60px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    border-right: 1px solid #444;
  }
  .tool-btn {
    width: 40px;
    height: 40px;
    background: #3a3a3a;
    margin: 4px 0;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s;
    font-size: 18px;
  }
  .tool-btn:hover {
    background: #555;
  }
  .tool-btn.active {
    background: #0078d7;
  }

  /* Canvas area */
  #canvasContainer {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #333;
    position: relative;
  }
  canvas {
    background: #fff;
    border: 1px solid #555;
    cursor: crosshair;
    box-shadow: 0 0 12px rgba(0,0,0,0.4);
  }

  /* Color panel */
  #colorPanel {
    background: #252525;
    width: 180px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-left: 1px solid #444;
  }
  #colorPanel input[type=color] {
    width: 100%;
    height: 40px;
    border: none;
    cursor: pointer;
  }
  .slider-container {
    display: flex;
    flex-direction: column;
    font-size: 12px;
    color: #ccc;
  }
  .slider-container label {
    margin-bottom: 4px;
  }
  input[type=range] {
    width: 100%;
  }
</style>
</head>
<body>

<div id="topBar">
  <div>
    <button id="saveBtn">üíæ Save</button>
    <button id="clearBtn">üßπ Clear</button>
  </div>
  <span>Symbol Editor</span>
</div>

<div id="mainContent">
  <!-- Toolbar -->
  <div id="toolbar">
    <div class="tool-btn active" data-tool="brush" title="Brush">‚úèÔ∏è</div>
    <div class="tool-btn" data-tool="eraser" title="Eraser">ü©π</div>
    <div class="tool-btn" data-tool="rect" title="Rectangle">‚ñ≠</div>
    <div class="tool-btn" data-tool="circle" title="Circle">‚ö™</div>
    <div class="tool-btn" data-tool="line" title="Line">„Ä£</div>
  </div>

  <!-- Canvas -->
  <div id="canvasContainer">
    <canvas id="editorCanvas" width="500" height="500"></canvas>
  </div>

  <!-- Color Panel -->
  <div id="colorPanel">
    <input type="color" id="colorPicker">
    <div class="slider-container">
      <label>R: <input type="range" id="rSlider" min="0" max="255"></label>
      <label>G: <input type="range" id="gSlider" min="0" max="255"></label>
      <label>B: <input type="range" id="bSlider" min="0" max="255"></label>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("editorCanvas");
const ctx = canvas.getContext("2d");

const colorPicker = document.getElementById("colorPicker");
const rSlider = document.getElementById("rSlider");
const gSlider = document.getElementById("gSlider");
const bSlider = document.getElementById("bSlider");

let brushColor = "#000000";
let currentTool = "brush";
let isDrawing = false;
let startX, startY;

function rgbToHex(r, g, b) {
  return "#" + [r, g, b].map(x => {
    const hex = x.toString(16);
    return hex.length === 1 ? "0" + hex : hex;
  }).join('');
}

function hexToRgb(hex) {
  const bigint = parseInt(hex.slice(1), 16);
  return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
}

// Tool buttons
document.querySelectorAll(".tool-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tool-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentTool = btn.dataset.tool;
  });
});

// Color sync
colorPicker.addEventListener("input", (e) => {
  const {r, g, b} = hexToRgb(e.target.value);
  rSlider.value = r;
  gSlider.value = g;
  bSlider.value = b;
  brushColor = e.target.value;
});
[rSlider, gSlider, bSlider].forEach(slider => {
  slider.addEventListener("input", () => {
    const r = parseInt(rSlider.value);
    const g = parseInt(gSlider.value);
    const b = parseInt(bSlider.value);
    brushColor = rgbToHex(r, g, b);
    colorPicker.value = brushColor;
  });
});

// Drawing
canvas.addEventListener("mousedown", (e) => {
  isDrawing = true;
  startX = e.offsetX;
  startY = e.offsetY;
  if (currentTool === "brush" || currentTool === "eraser") {
    ctx.beginPath();
    ctx.moveTo(startX, startY);
  }
});
canvas.addEventListener("mouseup", (e) => {
  if (!isDrawing) return;
  if (currentTool === "rect") {
    ctx.fillStyle = brushColor;
    ctx.fillRect(startX, startY, e.offsetX - startX, e.offsetY - startY);
  } else if (currentTool === "circle") {
    const radius = Math.sqrt(Math.pow(e.offsetX - startX, 2) + Math.pow(e.offsetY - startY, 2));
    ctx.beginPath();
    ctx.arc(startX, startY, radius, 0, Math.PI * 2);
    ctx.fillStyle = brushColor;
    ctx.fill();
  } else if (currentTool === "line") {
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.strokeStyle = brushColor;
    ctx.lineWidth = 2;
    ctx.stroke();
  }
  isDrawing = false;
});
canvas.addEventListener("mousemove", (e) => {
  if (!isDrawing) return;
  if (currentTool === "brush") {
    ctx.lineWidth = 5;
    ctx.lineCap = "round";
    ctx.strokeStyle = brushColor;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  } else if (currentTool === "eraser") {
    ctx.lineWidth = 20;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#fff";
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  }
});

// Clear and save
document.getElementById("clearBtn").addEventListener("click", () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
});
document.getElementById("saveBtn").addEventListener("click", () => {
  const dataURL = canvas.toDataURL();
  if (window.opener && typeof window.opener.receiveSymbol === "function") {
    window.opener.receiveSymbol(dataURL);
  }
  window.close();
});
</script>

</body>
</html>
